<html>
<header>
    <meta charset='utf-8'>
    <meta name='viewport' content='user-scalable=no width=device-width' />
    <title>도에이 지하철 운행 정보</title>
</header>
<style>
    body {
        margin: 0px;
        font-family: NanumGothic;
    }

    div.header {
        padding: 12px;
        color: white;
        background-color: #3A9C42;
        font-size: 22px;
        box-shadow: 1px 2px 4px 1px rgba(0, 0, 0, 0.3);
    }

    div.body {
        padding: 12px;
        margin: 0px auto;
        max-width: 768px;
    }

    div.footer {
        margin: 0px;
    }

    table {
        width: 100%;
        border: 1px solid #000000;
        border-collapse: collapse;
        margin: 0px;
    }

    td {
        width: 25%;
        border: 1px solid #000000;
        text-align: center;
        padding: 8px;
        vertical-align: middle;
    }

    tr.lines>td {
        font-size: 18px;
    }

    img {
        height: 22px;
        margin: 4px;
        vertical-align: middle;
        display: inline;
    }

    div#map {
        padding: 8px;
    }

    line, polyline {
        stroke-width: 5px;
        stroke-linejoin: round;
        stroke-linecap: round;
    }

    hr {
        margin: 0px;
    }

    p.copyright {
        text-align: center;
        font-size: 14px;
    }

    @media screen and (max-width: 768px) {
        img {
            margin: 0 auto;
            display: block;
        }

        tr.lines>td {
            font-size: 14px;
        }
    }
</style>

<body>
    <link href="https://hangeul.pstatic.net/hangeul_static/css/nanum-gothic.css" rel="stylesheet">
    <div class=header>
        도에이 지하철 실시간 운행 정보
    </div>
    <div class=body>
        <table>
            <tr class=lines>
                <td onclick='loadData("A");'><img src='./images/A.png'>아사쿠사선</td>
                <td onclick='loadData("I");'><img src='./images/I.png'>미타선</td>
                <td onclick='loadData("S");'><img src='./images/S.png'>신주쿠선</td>
                <td onclick='loadData("E");'><img src='./images/E.png'>오에도선</td>
            </tr>
        </table>
        <div id='map'></div>
        <hr>
    </div>
    <div class=footer>
        <p class=copyright>© 2023 Dark Tornado, All rights reserved.</p>
    </div>
    <script>
        function loadData(lineCode) {
            fetch('https://api.darktornado.net/subway/jp/toei?line=' + lineCode)
                .then((response) => response.json())
                .then((data) => {
                    createMap(data, lineCode);
                });
        }

        function createMap(data, lineCode) {
            if (lineCode == 'E') return createOedoLine(data);
            var m = 100;
            var height = m * data.length;
            var color = {
                'A': '#FF535F',
                'I': '#0067B0',
                'S': '#9FB01C'
                // 'E': '#CF3366'
            };
            var src = '<svg viewbox="0 0 600 ' + height + '" >';
            src += '<line x1="50" y1="10" x2="50" y2="' + (height - 10) + '" stroke="' + color[lineCode] + '" />';
            data.forEach((e, i) => {
                src += text(120, m * i + m / 2, e.stn, '#000000', 30);
                src += train(50, m * i + m / 2, e.up, 'up');
                src += train(150, m * i + m / 2, e.dn, 'dn');
            });
            document.getElementById('map').innerHTML = src;
        }

        function createOedoLine(data) {
            var m = 100;
            var height = m * data.length;
            var src = '<svg viewbox="0 0 600 ' + height + '" >';
            src += '<line x1="50" y1="10" x2="50" y2="' + (height - 10) + '" stroke="#CF3366" />';
            data.forEach((e, i) => {
                src += text(120, m * i + m / 2, e.stn, '#000000', 30);
                src += train(50, m * i + m / 2, e.up, 'up');
                src += train(150, m * i + m / 2, e.dn, 'dn');
            });
            document.getElementById('map').innerHTML = src;
        }

        function text(x, y, stn, color, size, align) {
            if (align == undefined) align = 'start';
            var style = '"';
            style += 'font-size: ' + size + 'px;'
            style += 'text-anchor: ' + align + ';'
            style += '"';
            return '<text style=' + style + ' x=' + x + ' y=' + y + ' fill=' + color + '\'>' + stn + '</text>';
        }

        function train(x, y, data, updn) {
            if (data.length == 0) return '';
            y -= 30;
            x -= updn == 'up' ? 40 : 80;
            var file = "images/train_" + updn + "_" + (data[0].type == '보통' ? 0 : 1) + ".png";
            return "<image xlink:href='" + file + "' x='" + x + "' y='" + y + "' width='20px'/>";
        }
    </script>
</body>

</html>